<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="WeAir"><link rel="alternative" href="/atom.xml" title="WeAir" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><title>安装Headscale及Tailscale - WeAir</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">WeAir</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2024-11-25T04:00:00.000Z">November 25, 2024</time><h1 class="post__title"><a href="/install-headscale-tailscale/">安装Headscale及Tailscale</a></h1><div class="post__main echo"><p><a href="https://tailscale.com/" target="_blank" rel="noopener">Tailscale</a>是一款基于<a href="https://www.wireguard.com/" target="_blank" rel="noopener">WireGuard</a>的组网工具，<a href="https://github.com/juanfont/headscale" target="_blank" rel="noopener">Headscale</a>是一款Tailscale控制服务器的开源实现。</p>
<h3 id="下载Headscale"><a href="#下载Headscale" class="headerlink" title="下载Headscale"></a>下载Headscale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/juanfont/headscale/releases/download/v0.23.0/headscale_0.23.0_linux_amd64 -O /usr/<span class="built_in">local</span>/bin/headscale</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/headscale</span><br></pre></td></tr></table></figure>

<h3 id="创建Headscale用户及运行目录"><a href="#创建Headscale用户及运行目录" class="headerlink" title="创建Headscale用户及运行目录"></a>创建Headscale用户及运行目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd headscale</span><br><span class="line">useradd -M -s `<span class="built_in">which</span> nologin` -g headscale headscale</span><br><span class="line">mkdir -p /etc/headscale /var/lib/headscale</span><br><span class="line">chown -R headscale:headscale /var/lib/headscale</span><br></pre></td></tr></table></figure>

<h3 id="下载并配置Headscale配置文件"><a href="#下载并配置Headscale配置文件" class="headerlink" title="下载并配置Headscale配置文件"></a>下载并配置Headscale配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/juanfont/headscale/v0.23.0/config-example.yaml -O /etc/headscale/config.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 修改server_url地址</span><br><span class="line">server_url: https://domain.name</span><br><span class="line">listen_addr: 127.0.0.1:8080</span><br><span class="line">...</span><br><span class="line"># 关闭IPv6地址</span><br><span class="line">prefixes:</span><br><span class="line">  # v6: fd7a:115c:a1e0::/48</span><br><span class="line">  v4: 100.64.0.0/10</span><br><span class="line">...</span><br><span class="line"># 关闭MagicDNS</span><br><span class="line">dns:</span><br><span class="line">  # magic_dns: true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="配置Nginx反代"><a href="#配置Nginx反代" class="headerlink" title="配置Nginx反代"></a>配置Nginx反代</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default      upgrade;</span><br><span class="line">    &apos;&apos;           close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80;</span><br><span class="line"></span><br><span class="line">    listen 443      ssl http2;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line"></span><br><span class="line">    server_name &lt;YOUR_SERVER_NAME&gt;;</span><br><span class="line"></span><br><span class="line">    ssl_certificate path/cert.crt;</span><br><span class="line">    ssl_certificate_key /path/cert.key;</span><br><span class="line">    ssl_protocols TLSv1.2 TLSv1.3;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:8080;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line">        proxy_set_header Host $server_name;</span><br><span class="line">        proxy_redirect http:// https://;</span><br><span class="line">        proxy_buffering off;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">        add_header Strict-Transport-Security &quot;max-age=15552000; includeSubDomains&quot; always;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试配置"><a href="#测试配置" class="headerlink" title="测试配置"></a>测试配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">headscale configtest</span><br></pre></td></tr></table></figure>

<h3 id="创建Systemd服务"><a href="#创建Systemd服务" class="headerlink" title="创建Systemd服务"></a>创建Systemd服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://headscale.net/packaging/headscale.systemd.service -O /etc/systemd/system/headscale.service</span><br></pre></td></tr></table></figure>

<h3 id="启动Headscale服务"><a href="#启动Headscale服务" class="headerlink" title="启动Headscale服务"></a>启动Headscale服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now headscale.service</span><br></pre></td></tr></table></figure>

<h3 id="下载安装Tailscale"><a href="#下载安装Tailscale" class="headerlink" title="下载安装Tailscale"></a>下载安装Tailscale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https://pkgs.tailscale.com/stable/tailscale_1.76.6_amd64.tgz -O /tmp/tailscale_1.76.6_amd64.tgz</span><br><span class="line">tar -zxvf /tmp/tailscale_1.76.6_amd64.tgz -C /tmp</span><br><span class="line">\mv /tmp/tailscale_1.76.6_amd64/systemd/tailscaled.service /etc/systemd/system/tailscale.service</span><br><span class="line">\mv /tmp/tailscale_1.76.6_amd64/systemd/tailscaled.defaults /etc/default/tailscaled</span><br><span class="line">\mv /tmp/tailscale_1.76.6_amd64/tailscaled /usr/sbin/tailscaled</span><br><span class="line">\mv /tmp/tailscale_1.76.6_amd64/tailscale /usr/bin/tailscale</span><br><span class="line">rm -rf /tmp/tailscale_1.76.6_amd64*</span><br></pre></td></tr></table></figure>

<h3 id="启动Tailscale"><a href="#启动Tailscale" class="headerlink" title="启动Tailscale"></a>启动Tailscale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now tailscale.service</span><br></pre></td></tr></table></figure>

<h3 id="Headscale添加新用户"><a href="#Headscale添加新用户" class="headerlink" title="Headscale添加新用户"></a>Headscale添加新用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">headscale user create user01</span><br></pre></td></tr></table></figure>

<h3 id="Headscale查看用户"><a href="#Headscale查看用户" class="headerlink" title="Headscale查看用户"></a>Headscale查看用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">headscale user list</span><br></pre></td></tr></table></figure>

<h3 id="Tailscale接入Headscale"><a href="#Tailscale接入Headscale" class="headerlink" title="Tailscale接入Headscale"></a>Tailscale接入Headscale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tailscale客户端</span></span><br><span class="line">tailscale up --login-server=https://domain.name --accept-routes=<span class="literal">true</span> --accept-dns=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Headscale控制端</span></span><br><span class="line">headscale nodes register --user USER --key mkey:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<h3 id="Tailscale查看状态"><a href="#Tailscale查看状态" class="headerlink" title="Tailscale查看状态"></a>Tailscale查看状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tailscale status</span><br></pre></td></tr></table></figure>

<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>更多配置信息可查看<a href="https://headscale.net/setup/requirements/" target="_blank" rel="noopener">Headscale</a>及<a href="https://tailscale.com/kb/1017/install" target="_blank" rel="noopener">Tailscale</a>文档说明。</p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/Headscale/">Headscale</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/Tailscale/">Tailscale</a></li></ul></footer></article><div class="comments" id="v-container"><script src="//unpkg.com/leancloud-storage@4.12.0/dist/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({
  el: '#v-container',
  appId: 'u1yQ1lKVQjHyzschdLsKRXrP-MdYXbMMI',
  appKey: 'gity6FddlUlmP23K5mzPOUIP',
  avatar: 'wavatar',
  lang: 'zh-cn',
  placeholder: 'ヾﾉ≧∀≦)o来啊，造作啊!',
  serverURLs: 'https://u1yQ1lKV.api.lncldglobal.com',
  notify: false,
  verify: false,
  pageSize: 20,
  avatarForce: false,
  visitor: true,
  highlight: true
});</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2019 - 2024 WeAir</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>